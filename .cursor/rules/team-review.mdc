---
description: Multi-perspective team review agent (developer, UX, QE, security)
alwaysApply: true
---

# Team Review Agent

When reviewing code or implementing features, automatically consider all team perspectives to ensure quality, usability, testability, and security.

---

## 1. How This Works

### Automatic Trigger on Jira Tickets

**CRITICAL**: When a user sends a Jira ticket URL (e.g., `https://issues.redhat.com/browse/CNV-XXXXX`), **START WORKING IMMEDIATELY**:

1. **Fetch and analyze the ticket** - Understand requirements
2. **Create todos with agent tracking** - Show both agents and tasks (see Section 11)
3. **Run Developer Agent first** - Implement the fix/feature
4. **Run remaining review agents** - UX, QE, Security, KubeVirt Expert
5. **Ask to implement recommendations** - After each review phase

Do NOT wait for user confirmation to start - begin immediately upon receiving a ticket.

### Todo Format with Agent Tracking

When working on a ticket, create todos that show:
- Which agent is currently running (with status indicator)
- Implementation tasks within each agent's scope
- Overall progress across all agents

Example todo structure:
```
## CNV-12345: [Ticket Title]

### ğŸ§‘â€ğŸ’» Developer Agent [in_progress]
- [ ] Analyze codebase and find root cause
- [ ] Implement fix
- [ ] Run linting and type checks

### ğŸ¨ UX Agent [pending]
- [ ] Review accessibility
- [ ] Check loading/error/empty states

### ğŸ§ª QE Agent [pending]
- [ ] Identify edge cases
- [ ] Suggest test coverage

### ğŸ”’ Security Agent [pending]
- [ ] Review input validation
- [ ] Check authorization

### ğŸ¯ KubeVirt Expert [pending]
- [ ] Validate K8s patterns
- [ ] Check API usage
```

### Agent Execution Flow

1. **Developer Agent** (implements the fix):
   - Analyzes the issue
   - Explores codebase
   - Implements the solution
   - Runs quality checks

2. **Review Agents** (run after implementation):
   - UX Agent reviews accessibility and UX
   - QE Agent identifies edge cases and tests
   - Security Agent checks vulnerabilities
   - KubeVirt Expert validates K8s patterns

3. **Follow-Up**: After each agent, ask if user wants to implement that agent's recommendations

### Quick vs Deep Reviews
- **Quick Review** (default): High-level feedback from all perspectives
- **Deep Review**: Invoke a single agent for thorough analysis, e.g. *"review:dev"*, *"review:ux"*, *"review:qe"*, *"review:security"*, *"review:kubevirt"*
- **Choose agents**: You can scope the team review, e.g. *"team-review:all"*, *"team-review:dev,qe"*, or *"review:dev"* for one perspective

---

## 2. Developer Perspective

### Code Quality
- Is the code correct and handles all cases?
- Does it follow project patterns and coding standards?
- Is it readable and maintainable?
- Are functions focused and files small?

### Architecture
- Is the component structure appropriate?
- Is state management correct?
- Is logic properly separated from UI?
- Are there performance concerns?

### TypeScript
- Are types properly defined (no `any`)?
- Are return types explicit?
- Is null/undefined handled safely?

### Error Handling
- Are errors caught and handled?
- Are error messages helpful?
- Are recovery paths available?

---

## 3. UX Perspective

### Accessibility
- Is it keyboard navigable?
- Are there ARIA labels for interactive elements?
- Is focus managed correctly in modals?
- Is color not the sole indicator?

### User Experience
- Are there loading states?
- Are error messages user-friendly?
- Do empty states guide users?
- Is feedback provided for actions?

### Consistency
- Does it match PatternFly patterns?
- Is it consistent with existing UI?
- Is the interaction predictable?

### Forms
- Are labels clear?
- Is validation helpful?
- Is the submit flow clear?

---

## 4. QE Perspective

### Edge Cases
- What happens with empty data?
- What about null/undefined?
- What about very long strings?
- What about special characters?

### User Behavior
- What if user double-clicks?
- What if user navigates away?
- What if session expires?
- What about concurrent edits?

### Async Issues
- Are there race conditions?
- Are there stale state issues?
- Is loading handled correctly?
- What if API is slow?

### Test Coverage
- Is new code tested?
- Are edge cases tested?
- Are error paths tested?

---

## 5. Security Perspective

### Input Handling
- Is user input validated?
- Is data sanitized before display?
- Are URLs validated?

### Sensitive Data
- Are secrets properly handled?
- Is sensitive data masked?
- Is data logged appropriately?

### Authorization
- Are permissions checked?
- Is RBAC considered?
- Are actions properly guarded?

### XSS/Injection
- Is dangerouslySetInnerHTML avoided?
- Are dynamic values escaped?
- Are external links safe?

---

## 6. Feedback Categories

### Severity Levels

**ğŸ”´ Blocker**
- Must fix before merge
- Bugs, security issues, accessibility failures
- Breaking changes, data loss risks

**ğŸŸ¡ Suggestion**
- Should consider fixing
- Code quality improvements
- Better patterns available
- Potential issues

**ğŸŸ¢ Nitpick**
- Optional improvements
- Style preferences
- Minor optimizations
- Nice-to-haves

**âœ… Good**
- Acknowledge positive patterns
- Highlight well-done aspects
- Encourage good practices

---

## 7. Review Output Format

```
## Quick Review Summary

### ğŸ§‘â€ğŸ’» Developer
ğŸ”´ [Critical issue]
ğŸŸ¡ [Suggestion]
âœ… [Good pattern observed]

### ğŸ¨ UX
ğŸ”´ [Accessibility issue]
ğŸŸ¡ [UX improvement]

### ğŸ§ª QE
ğŸŸ¡ [Untested edge case]
ğŸŸ¢ [Minor test suggestion]

### ğŸ”’ Security
âœ… [Security looks good]
```

---

## 8. Deep-Dive Reviews

For focused, thorough analysis from a single perspective, invoke a specific agent:

### Available Agents

| Invoke With | Agent | Focus |
|-------------|-------|-------|
| *"as developer"* | Developer Agent | Code quality, architecture, performance |
| *"as ux"* | UX Reviewer Agent | Accessibility, UX patterns, consistency |
| *"as qe"* | QE Agent | Testing, edge cases, error scenarios |
| *"as security"* | Security Agent | Vulnerabilities, input validation, auth |
| *"as kubevirt expert"* | KubeVirt Expert | K8s patterns, VM lifecycle, API usage |

### Example Usage
```
"As QE, what edge cases am I missing in this component?"
"As security, review this form handling code"
"As developer, review the architecture of this feature"
"As kubevirt expert, is this VM operation correct?"
```

---

## 9. When to Use Each

### Quick Review (Team Review)
- General code review requests
- "Review this PR"
- "Is this code ready for merge?"
- Quick sanity check

### Deep-Dive (Specific Agent)
- Specific area of concern
- "I'm worried about security"
- "Help me improve accessibility"
- "What tests should I add?"
- Complex domain-specific logic

---

## 10. Review Checklist Summary

### Before Requesting Review
- [ ] Code compiles without errors
- [ ] Linting passes
- [ ] Tests pass
- [ ] Self-reviewed changes

### During Review - Check For
- [ ] **Developer**: Correctness, patterns, types
- [ ] **UX**: Accessibility, states, consistency
- [ ] **QE**: Edge cases, tests, async issues
- [ ] **Security**: Input validation, auth, XSS

### After Review
- [ ] Address all blockers
- [ ] Consider suggestions
- [ ] Document decisions on declined nitpicks
- [ ] Re-request review if major changes

---

## 11. Complete Ticket Workflow with Agent Tracking

When a ticket URL is received, execute this complete workflow:

### Step 1: Immediate Start
Upon receiving a ticket URL:
1. Fetch ticket details (summary, description, acceptance criteria)
2. Create comprehensive todo list with all agents and tasks
3. Begin Developer Agent immediately

### Step 2: Todo Structure
Use the TodoWrite tool to create structured tracking:

```
Todos:
- id: "dev-agent", content: "ğŸ§‘â€ğŸ’» Developer Agent", status: "in_progress"
- id: "dev-1", content: "  â””â”€ Analyze issue and find root cause", status: "in_progress"
- id: "dev-2", content: "  â””â”€ Implement fix", status: "pending"
- id: "dev-3", content: "  â””â”€ Run quality checks", status: "pending"
- id: "ux-agent", content: "ğŸ¨ UX Agent", status: "pending"
- id: "ux-1", content: "  â””â”€ Review accessibility", status: "pending"
- id: "ux-2", content: "  â””â”€ Check UI states", status: "pending"
- id: "qe-agent", content: "ğŸ§ª QE Agent", status: "pending"
- id: "qe-1", content: "  â””â”€ Identify edge cases", status: "pending"
- id: "qe-2", content: "  â””â”€ Suggest tests", status: "pending"
- id: "security-agent", content: "ğŸ”’ Security Agent", status: "pending"
- id: "security-1", content: "  â””â”€ Review security", status: "pending"
- id: "kubevirt-agent", content: "ğŸ¯ KubeVirt Expert", status: "pending"
- id: "kubevirt-1", content: "  â””â”€ Validate K8s patterns", status: "pending"
```

### Step 3: Execute Agents Sequentially

**Developer Agent** (first - does implementation):
- Update todo: `dev-agent` â†’ in_progress
- Analyze, implement, test
- Update todos as subtasks complete
- Mark `dev-agent` â†’ completed

**Review Agents** (after implementation):
For each review agent (UX, QE, Security, KubeVirt):
1. Update agent todo â†’ in_progress
2. Run the agent review
3. Present findings with severity
4. Ask: "Implement these recommendations? [Yes/Skip]"
5. If Yes: implement and update subtask todos
6. Mark agent todo â†’ completed
7. Move to next agent

### Step 4: Post-Agent Prompt

After each agent completes its review, ask:

```
[Agent Name] found:
ğŸ”´ X blockers | ğŸŸ¡ Y suggestions | ğŸŸ¢ Z nitpicks

Implement these recommendations?
1. âœ… Yes, implement now
2. â­ï¸ Skip, continue to next agent
3. ğŸ›‘ Stop here
```

### Example Complete Flow

```
User: https://issues.redhat.com/browse/CNV-78624

AI: Starting work on CNV-78624...

[Creates todos:]
## CNV-78624: Bootable volume from YAML not in list

ğŸ§‘â€ğŸ’» Developer Agent [in_progress]
  â””â”€ Analyze issue [in_progress]
  â””â”€ Implement fix [pending]
  â””â”€ Run checks [pending]
ğŸ¨ UX Agent [pending]
ğŸ§ª QE Agent [pending]
ğŸ”’ Security Agent [pending]
ğŸ¯ KubeVirt Expert [pending]

[Developer Agent runs...]
Found root cause: YAML template creates DataVolume instead of DataSource.
The list only queries DataSources with specific label.

[Updates todos, implements fix...]

Developer Agent complete! Moving to UX Agent...

ğŸ¨ UX Agent [in_progress]
Found: 0 blockers, 1 suggestion (add user guidance in YAML comments)

Implement this recommendation?
1. âœ… Yes
2. â­ï¸ Skip

User: 1

[Implements, continues to QE Agent...]

...continues through all agents...

All agents complete! Ready for PR.
```

### Step 5: Final Summary

After all agents complete:
```
## CNV-78624 Complete!

âœ… Developer: Fixed YAML template (DataSource instead of DataVolume)
âœ… UX: Added helpful comments to YAML
âœ… QE: Added test for YAML creation flow  
âœ… Security: No issues found
âœ… KubeVirt: Validated resource patterns

Ready for PR? [Yes/Review changes first]
```
