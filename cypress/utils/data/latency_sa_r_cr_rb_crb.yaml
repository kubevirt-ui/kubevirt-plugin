---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vm-latency-checkup-sa
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kubevirt-vm-latency-checker
rules:
  - apiGroups: ['kubevirt.io']
    resources: ['virtualmachineinstances']
    verbs: ['get', 'create', 'delete']
  - apiGroups: ['subresources.kubevirt.io']
    resources: ['virtualmachineinstances/console']
    verbs: ['get']
  - apiGroups: ['k8s.cni.cncf.io']
    resources: ['network-attachment-definitions']
    verbs: ['get']
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kubevirt-vm-latency-checker
subjects:
  - kind: ServiceAccount
    name: vm-latency-checkup-sa
roleRef:
  kind: Role
  name: kubevirt-vm-latency-checker
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kiagnose-configmap-access
rules:
  - apiGroups: ['']
    resources: ['configmaps']
    verbs: ['get', 'update']
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kiagnose-configmap-access
subjects:
  - kind: ServiceAccount
    name: vm-latency-checkup-sa
roleRef:
  kind: Role
  name: kiagnose-configmap-access
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kubevirt-vm-latency-checker
rules:
  - verbs:
      - get
      - create
      - delete
    apiGroups:
      - kubevirt.io
    resources:
      - virtualmachineinstances
  - verbs:
      - get
    apiGroups:
      - subresources.kubevirt.io
    resources:
      - virtualmachineinstances/console
  - verbs:
      - get
    apiGroups:
      - k8s.cni.cncf.io
    resources:
      - network-attachment-definitions
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kubevirt-vm-latency-checker
subjects:
  - kind: ServiceAccount
    name: vm-latency-checkup-sa
    namespace: auto-test-ns
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kubevirt-vm-latency-checker
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kiagnose-configmap-access
rules:
  - verbs:
      - get
      - update
    apiGroups:
      - ''
    resources:
      - configmaps
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kiagnose-configmap-access
subjects:
  - kind: ServiceAccount
    name: vm-latency-checkup-sa
    namespace: auto-test-ns
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kiagnose-configmap-access
